<?xml version="1.0" encoding="utf-8"?>
<?include InformationVariables.wxi ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="$(var.ProductID)" Name="$(var.ProductName) $(var.VersionNumber) $(var.Configuration)" Language="1033" Version="$(var.VersionNumber)" Manufacturer="$(var.CompanyName)" UpgradeCode="$(var.UpgradeCode)">
        <!-- Package IDs are valid for a single package version only - they are autogenerated by WiX -->
        <!-- Let's require Windows Installer 4.0 (included in Vista) -->
        <!-- And ALWAYS install per machine!!! -->
        <Package InstallerVersion="400" Compressed="yes" InstallPrivileges="elevated" AdminImage="yes" InstallScope="perMachine" />
        <!-- Upgrade logic -->
        <!-- AllowSameVersionUpgrades -> Always upgrade, never allow two versions to be installed next to each other -->
        <!-- AllowSameVersionUpgrades causes ICE61 which must be ignored -->
        <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
        <Property Id="MSIUSEREALADMINDETECTION" Value="1" />
        <Media Id="1" Cabinet="projectcleaner.cab" EmbedCab="yes" />
        <Binary Id="ProjectCleanerBanner" SourceFile="$(var.ProjectDir)img\banner.bmp" />
        <!-- License agreement text: dummy. Real text is set in WXS file -->
        <WixVariable Id="WixUILicenseRtf" Value="$(var.ProjectDir)res\Readme.rtf" />
        <!-- UI customization -->
        <WixVariable Id="WixUIBannerBmp" Value="$(var.ProjectDir)img\banner.bmp" />
        <WixVariable Id="WixUIDialogBmp" Value="$(var.ProjectDir)img\app_bg.bmp" />
        <!-- Define icons (ID should not be longer than 18 chars and must end with ".exe") -->
        <Icon Id="Icon.exe" SourceFile="$(var.ProjectDir)img\app.ico" />
        <!-- Set properties for add/remove programs -->
        <Property Id="ARPPRODUCTICON" Value="Icon.exe" />
        <Property Id="ARPHELPLINK" Value="$(var.InfoURL)" />
        <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />
        <!-- Remove repair -->
        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
        <UI>
            <UIRef Id="WixUI_InstallDir" />
        </UI>
        <Feature Id="AppFeatures" Title="ClientService" Level="1">
            <ComponentGroupRef Id="AppComponents" />
        </Feature>
    </Product>
    <Fragment>
        <ComponentGroup Id="AppComponents">
            <Component Id="AppComponents" Guid="$(var.AppComponentsGuid)" Directory="versionFolder">
                <File Id="ProjectCleaner.exe.config" Name="ProjectCleaner.exe.config" Source="$(var.SourceFolder)\$(var.Configuration)\ProjectCleaner.exe.config" Vital="yes" KeyPath="no" DiskId="1" />
                <File Id="Microsoft.Extensions.FileSystemGlobbing.xml" Name="Microsoft.Extensions.FileSystemGlobbing.xml" Source="$(var.SourceFolder)\$(var.Configuration)\Microsoft.Extensions.FileSystemGlobbing.xml" Vital="yes" KeyPath="no" DiskId="1" />
                <File Id="Microsoft.Extensions.FileSystemGlobbing.dll" Name="Microsoft.Extensions.FileSystemGlobbing.dll" Source="$(var.SourceFolder)\$(var.Configuration)\Microsoft.Extensions.FileSystemGlobbing.dll" Vital="yes" KeyPath="no" DiskId="1" />
                <File Id="ProjectCleaner.exe" Name="ProjectCleaner.exe" Source="$(var.SourceFolder)\$(var.Configuration)\ProjectCleaner.exe" Vital="yes" KeyPath="yes" DiskId="1" Checksum="yes" />
            </Component>
            <Component Id="AppShortcut" Guid="$(var.AppShortcutGuid)" Directory="ApplicationProgramsFolder">
                <Shortcut Id="AppStartMenuShortcut" Name="$(var.ProductName) $(var.VersionNumber) $(var.Configuration)" Description="$(var.ProductName) $(var.VersionNumber) $(var.Configuration)" Target="[#ProjectCleaner.exe]" WorkingDirectory="versionFolder" />
                <RemoveFolder Id="RemoveApplicationProgramsFolder" Directory="ApplicationProgramsFolder" On="uninstall" />
                <RegistryValue Root="HKCU" Key="Software\$(var.CompanyName)\$(var.ProductName)\$(var.VersionNumber)\$(var.Configuration)" Name="installed" Type="integer" Value="1" KeyPath="yes" />
            </Component>
            <Component Id="AppShortcutDesktop" Guid="$(var.AppShortcutDesktopGuid)" Directory="DesktopFolder">
                <Shortcut Id="AppDesktopShortcut" Name="$(var.ProductName) $(var.VersionNumber) $(var.Configuration)" Description="$(var.ProductName) $(var.VersionNumber) $(var.Configuration)" Target="[#ProjectCleaner.exe]" WorkingDirectory="versionFolder" />
                <RemoveFolder Id="RemoveDesktopFolder" Directory="DesktopFolder" On="uninstall" />
                <RegistryValue Root="HKCU" Key="Software\$(var.CompanyName)\$(var.ProductName)\$(var.VersionNumber)\$(var.Configuration)" Name="installed" Type="integer" Value="1" KeyPath="yes" />
            </Component>
        </ComponentGroup>
    </Fragment>
    <Fragment>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="WINDOWSVOLUME">
                <Directory Id="ProgramFilesFolder">
                    <Directory Id="INSTALLFOLDER" Name="$(var.CompanyName)">
                        <Directory Id="mainFolder" Name="$(var.ProductName) $(var.Configuration)">
                            <Directory Id="versionFolder" Name="$(var.VersionNumber)"></Directory>
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="$(var.ProductName) $(var.Configuration)" />
            </Directory>
            <Directory Id="DesktopFolder" Name="Desktop"></Directory>
        </Directory>
    </Fragment>
</Wix>